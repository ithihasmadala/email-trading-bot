name: Run Python Script

on:  
  push:  # Triggers on push
  workflow_dispatch:  # Allows manual triggering

jobs:
  run-script:
    runs-on: ubuntu-latest
    env:
      QUANTITY: ${{ secrets.QUANTITY }}
      TAKE_PROFIT: ${{ secrets.TAKE_PROFIT }}
      STOP_LOSS: ${{ secrets.STOP_LOSS }}
      TESTNET_URL: ${{ secrets.TESTNET_URL }}
      POLLING_INTERVAL: ${{ secrets.POLLING_INTERVAL }}
      APP_PASSWORD: ${{ secrets.APP_PASSWORD }}
      TESTNET_API_KEY: ${{ secrets.TESTNET_API_KEY }}
      TESTNET_API_SECRET: ${{ secrets.TESTNET_API_SECRET }}
      EMAIL_USERNAME: ${{ secrets.EMAIL_USERNAME }}
      EMAIL_SENDERS: ${{ secrets.EMAIL_SENDERS }}
      
    steps:
      - uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v3
        with:
          python-version: '3.x'

      - name: Install dependencies
        run: pip3 install -r requirements.txt

      - name: Run script continuously
        run: |
          while true; do
            echo "Running script at $(date)"
            python3 email_listener.py
            sleep 90
          done
